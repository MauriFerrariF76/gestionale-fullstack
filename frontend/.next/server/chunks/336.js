exports.id=336,exports.ids=[336],exports.modules={716:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,6444,23)),Promise.resolve().then(n.t.bind(n,6042,23)),Promise.resolve().then(n.t.bind(n,8170,23)),Promise.resolve().then(n.t.bind(n,9477,23)),Promise.resolve().then(n.t.bind(n,9345,23)),Promise.resolve().then(n.t.bind(n,2089,23)),Promise.resolve().then(n.t.bind(n,6577,23)),Promise.resolve().then(n.t.bind(n,1307,23))},1048:(e,t,n)=>{"use strict";n.d(t,{K2:()=>c,WY:()=>i,cG:()=>a});var r=n(687),o=n(3210),s=n.n(o);let l=(0,o.createContext)(void 0),i=({children:e})=>{let[t,n]=(0,o.useState)(new Map),[s,i]=(0,o.useState)(0),a=(0,o.useCallback)(()=>{i(e=>e+1)},[]),u=(0,o.useCallback)(e=>{n(t=>new Map(t.set(e.id,e)))},[]),c=(0,o.useCallback)(e=>t.get(e),[t]),d=(0,o.useCallback)(e=>f(e),[t]),f=(0,o.useCallback)(e=>{let n=t.get(e);return{visibleColumns:n?.defaultVisibleColumns||[],sortConfig:null}},[t]),h=(0,o.useCallback)((e,t)=>{},[]),m=(0,o.useCallback)(e=>d(e),[d]),C=(0,o.useCallback)((e,t)=>{let n={...d(e),...t};h(e,n),a()},[d,h,a]),b=(0,o.useCallback)(e=>{let t=f(e);h(e,t),a()},[f,h,a]),g=(0,o.useCallback)((e,n)=>{let r=t.get(e),o=r?.columns.find(e=>e.key===n);if(o?.sortable===!1)return;let s=d(e).sortConfig,l=null;s?.key===n?"asc"===s.direction&&(l={key:n,direction:"desc"}):l={key:n,direction:"asc"},C(e,{sortConfig:l})},[t,d,C]),v=(0,o.useCallback)((e,t)=>{let n=d(e).sortConfig;return n?[...t].sort((e,t)=>{let r=e[n.key],o=t[n.key];return null==r?1:null==o?-1:r<o?"asc"===n.direction?-1:1:r>o?"asc"===n.direction?1:-1:0}):t},[d]),y=(0,o.useCallback)(e=>{let n=t.get(e),r=d(e);return n?r.visibleColumns.map(e=>{let t=n.columns.find(t=>t.key===e);return t||null}).filter(Boolean):[]},[t,d]),p=(0,o.useCallback)(()=>{},[t,d]),k=(0,o.useCallback)(e=>{if(!e||"object"!=typeof e||null===e||!("configs"in e))return void console.error("Formato file non valido");try{let n=e.configs;Object.entries(n).forEach(([e,n])=>{t.has(e)&&h(e,n)}),window.location.reload()}catch(e){console.error("Errore durante l'import:",e)}},[t,h]);return(0,r.jsx)(l.Provider,{value:{registerSchema:u,getSchema:c,getConfig:m,updateConfig:C,resetConfig:b,handleSort:g,sortData:v,exportConfig:p,importConfig:k,getVisibleColumnsWithConfig:y},children:e})},a=()=>{let e=(0,o.useContext)(l);if(void 0===e)throw Error("useTableConfig deve essere usato dentro TableConfigProvider");return e},u=()=>{let[e,t]=(0,o.useState)(!1);return s().useEffect(()=>{t(!0)},[]),e},c=e=>{let t=a(),n=u(),r=t.getConfig(e),o=t.getSchema(e);return{visibleColumns:r.visibleColumns,sortConfig:n?r.sortConfig:null,allColumns:o?.columns||[],defaultColumns:o?.defaultVisibleColumns||[],updateConfig:n=>t.updateConfig(e,n),resetConfig:()=>t.resetConfig(e),handleSort:n=>t.handleSort(e,n),sortData:n=>t.sortData(e,n),getVisibleColumnsWithConfig:()=>t.getVisibleColumnsWithConfig(e),isClient:n}}},1108:(e,t,n)=>{"use strict";n.d(t,{A:()=>i,O:()=>a});var r=n(687),o=n(3210);function s(e){return`${"/api".replace(/\/$/,"")}/${e.replace(/^\//,"")}`}let l=(0,o.createContext)(void 0);function i(){let e=(0,o.useContext)(l);if(!e)throw Error("useAuth deve essere usato dentro AuthProvider");return e}let a=({children:e})=>{let[t,n]=(0,o.useState)(null),[i,a]=(0,o.useState)(null),[u,c]=(0,o.useState)(null),[d,f]=(0,o.useState)(!0),[h,m]=(0,o.useState)(!1),[C,b]=(0,o.useState)(null);async function g(e,t,r){f(!0),m(!1),b(null);try{let o=await fetch(s("auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,mfaCode:r})}),l=await o.json();if(l.mfaRequired&&l.userId)m(!0),b(l.userId),a(null),c(null),n(null);else if(l.accessToken&&l.refreshToken&&l.user)a(l.accessToken),c(l.refreshToken),n(l.user),m(!1),b(null),await k("login","Login riuscito");else if(l.error)throw Error(l.error)}catch(e){if(n(null),a(null),c(null),e instanceof Error)throw e;throw Error("Errore sconosciuto durante il login")}finally{f(!1)}}async function v(e,t){f(!0);try{let n=await fetch(s("auth/mfa/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,mfaCode:t})}),r=await n.json();if(r.success&&r.accessToken&&r.refreshToken)a(r.accessToken),c(r.refreshToken),m(!1),b(null),await p(),await k("mfa","MFA verificato");else if(r.error)throw Error(r.error)}catch(e){throw e}finally{f(!1)}}async function y(){f(!0);try{u&&await fetch(s("auth/logout"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:u})}),n(null),a(null),c(null),m(!1),b(null),await k("logout","Logout utente")}finally{f(!1)}}async function p(){if(i){f(!0);try{let e=await fetch(s("auth/userinfo"),{method:"GET",headers:{Authorization:`Bearer ${i}`}}),t=await e.json();t.user?n(t.user):n(null)}catch{n(null)}finally{f(!1)}}}async function k(e,n){try{await fetch(s("auth/log"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t?.id||C,action:e,ip:void 0,timestamp:new Date().toISOString(),details:n})})}catch{}}return(0,o.useEffect)(()=>{f(!1)},[]),(0,o.useEffect)(()=>{i?sessionStorage.setItem("accessToken",i):sessionStorage.removeItem("accessToken"),u?sessionStorage.setItem("refreshToken",u):sessionStorage.removeItem("refreshToken")},[i,u]),(0,o.useEffect)(()=>{i?p():n(null)},[i]),(0,r.jsx)(l.Provider,{value:{user:t,accessToken:i,refreshToken:u,isAuthenticated:!!t&&!!i,loading:d,mfaRequired:h,login:g,verifyMfa:v,logout:y,fetchUser:p},children:e})}},1473:(e,t,n)=>{"use strict";n.d(t,{default:()=>c});var r=n(687),o=n(6189),s=n(1108);function l({children:e}){let{isAuthenticated:t,loading:n}=(0,s.A)();return((0,o.useRouter)(),n)?(0,r.jsx)("div",{className:"text-center py-10 text-info",children:"Caricamento autenticazione..."}):t?(0,r.jsx)(r.Fragment,{children:e}):null}n(3210);var i=n(1048),a=n(9154),u=n(8912);function c({children:e}){let t=(0,o.usePathname)();return(0,r.jsxs)(s.O,{children:[(0,r.jsx)(i.WY,{children:"/login"===t?e:(0,r.jsx)(l,{children:e})}),(0,r.jsx)(a.G,{config:{plugins:[u.A]}})]})}},2704:()=>{},3642:(e,t,n)=>{Promise.resolve().then(n.bind(n,8502))},3810:(e,t,n)=>{Promise.resolve().then(n.bind(n,1473))},7148:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,6346,23)),Promise.resolve().then(n.t.bind(n,7924,23)),Promise.resolve().then(n.t.bind(n,5656,23)),Promise.resolve().then(n.t.bind(n,99,23)),Promise.resolve().then(n.t.bind(n,8243,23)),Promise.resolve().then(n.t.bind(n,8827,23)),Promise.resolve().then(n.t.bind(n,2763,23)),Promise.resolve().then(n.t.bind(n,7173,23))},8014:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l,metadata:()=>s});var r=n(7413);n(2704);var o=n(8502);let s={description:"Sistema gestionale Ferrari Pietro SNC"};function l({children:e}){return(0,r.jsx)("html",{lang:"it",className:"dark",children:(0,r.jsx)("body",{className:"bg-gray-900 text-white min-h-screen",children:(0,r.jsx)(o.default,{children:e})})})}},8502:(e,t,n)=>{"use strict";n.d(t,{default:()=>r});let r=(0,n(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/mauri/gestionale-fullstack/frontend/components/ClientLayout.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/mauri/gestionale-fullstack/frontend/components/ClientLayout.tsx","default")}};