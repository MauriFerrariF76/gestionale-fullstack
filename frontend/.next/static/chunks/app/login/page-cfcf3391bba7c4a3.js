(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{1130:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var r=s(5155);s(2115);var a=s(5695),l=s(6874),n=s.n(l),o=s(6766);let i=e=>{let{className:t=""}=e,s=(0,a.usePathname)(),l=[{href:"/",label:"Dashboard",icon:(0,r.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,r.jsx)("line",{x1:"9",y1:"9",x2:"15",y2:"9"}),(0,r.jsx)("line",{x1:"9",y1:"15",x2:"15",y2:"15"})]})},{href:"/commesse",label:"Commesse",icon:(0,r.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{d:"M9 12l2 2 4-4"}),(0,r.jsx)("path",{d:"M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"})]})},{href:"/dipendenti",label:"Dipendenti",icon:(0,r.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,r.jsx)("circle",{cx:"12",cy:"7",r:"4"})]})},{href:"/clienti",label:"Clienti",icon:(0,r.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,r.jsx)("circle",{cx:"9",cy:"7",r:"4"})]})},{href:"/fornitori",label:"Fornitori",icon:(0,r.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),(0,r.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,r.jsx)("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),(0,r.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})},{href:"/documenti",label:"Documenti",icon:(0,r.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,r.jsx)("polyline",{points:"14,2 14,8 20,8"}),(0,r.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,r.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),(0,r.jsx)("polyline",{points:"10,9 9,9 8,9"})]})},{href:"/impostazioni",label:"Impostazioni",icon:(0,r.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,r.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}],i=e=>"/"===e?"/"===s:s.startsWith(e),c=e=>{let{item:t}=e,s=i(t.href);return(0,r.jsxs)(n(),{href:t.href,className:"group cursor-pointer flex items-center space-x-3 p-3 rounded-md transition-all duration-200 ".concat(s?"bg-neutral-700/50 transform scale-[0.98]":"hover:bg-neutral-700/50 hover:transform hover:scale-[0.98] active:scale-[0.96]"),children:[(0,r.jsx)("div",{className:"".concat(s?"text-[#3B82F6]":"text-neutral-400"),children:t.icon}),(0,r.jsx)("span",{className:"text-sm font-medium ".concat(s?"text-[#3B82F6]":"text-neutral-300 group-hover:text-neutral-100"),children:t.label})]})};return(0,r.jsxs)("aside",{className:"w-64 bg-neutral-850 border-r border-neutral-600 flex flex-col ".concat(t),children:[(0,r.jsx)("div",{className:"p-6 border-b border-neutral-600",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-12 h-8 flex items-center",children:(0,r.jsx)(o.default,{src:"/ferrari-pietro-logo.png",alt:"Ferrari Pietro Snc",width:48,height:32,className:"w-full h-full object-contain"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xs font-semibold text-neutral-200 leading-tight",children:"FERRARI PIETRO SNC"}),(0,r.jsx)("p",{className:"text-xs text-neutral-500 mt-0.5",children:"Gestionale"})]})]})}),(0,r.jsx)("nav",{className:"flex-1 p-4 space-y-1",children:l.map(e=>(0,r.jsx)(c,{item:e},e.href))}),(0,r.jsx)("div",{className:"p-4 border-t border-neutral-600",children:(0,r.jsxs)("div",{className:"text-xs text-neutral-500 text-center",children:["v1.0 â€¢ ",(0,r.jsx)("span",{className:"text-[#3B82F6]",children:"Sistema Online"})]})})]})},c=e=>{let{children:t,pageTitle:s,pageDescription:a,headerActions:l,className:n=""}=e;return(0,r.jsxs)("div",{className:"min-h-screen bg-neutral-800 text-neutral-100 flex ".concat(n),children:[(0,r.jsx)(i,{}),(0,r.jsxs)("main",{className:"flex-1 flex flex-col",children:[(0,r.jsxs)("header",{className:"bg-neutral-800 border-b border-neutral-600 px-8 py-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-neutral-50",children:s}),(0,r.jsx)("p",{className:"text-sm text-neutral-400",children:a})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[l,(0,r.jsx)("div",{className:"w-3 h-3 bg-[#3B82F6] rounded-full animate-pulse",title:"Sistema Online"})]})]}),(0,r.jsx)("div",{className:"flex-1 p-6 overflow-auto",children:t})]})]})}},3274:(e,t,s)=>{"use strict";s.d(t,{A:()=>o,O:()=>i});var r=s(5155),a=s(2115);function l(e){return"".concat("https://gestionale.ferraripietrosnc.com/api".replace(/\/$/,""),"/").concat(e.replace(/^\//,""))}let n=(0,a.createContext)(void 0);function o(){let e=(0,a.useContext)(n);if(!e)throw Error("useAuth deve essere usato dentro AuthProvider");return e}let i=e=>{let{children:t}=e,[s,o]=(0,a.useState)(null),[i,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[x,h]=(0,a.useState)(!0),[m,f]=(0,a.useState)(!1),[p,v]=(0,a.useState)(null);async function g(e,t,s){h(!0),f(!1),v(null);try{let r=await fetch(l("auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,mfaCode:s})}),a=await r.json();if(a.mfaRequired&&a.userId)f(!0),v(a.userId),c(null),u(null),o(null);else if(a.accessToken&&a.refreshToken&&a.user)c(a.accessToken),u(a.refreshToken),o(a.user),f(!1),v(null),await N("login","Login riuscito");else if(a.error)throw Error(a.error)}catch(e){if(o(null),c(null),u(null),e instanceof Error)throw e;throw Error("Errore sconosciuto durante il login")}finally{h(!1)}}async function j(e,t){h(!0);try{let s=await fetch(l("auth/mfa/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,mfaCode:t})}),r=await s.json();if(r.success&&r.accessToken&&r.refreshToken)c(r.accessToken),u(r.refreshToken),f(!1),v(null),await y(),await N("mfa","MFA verificato");else if(r.error)throw Error(r.error)}catch(e){throw e}finally{h(!1)}}async function b(){h(!0);try{d&&await fetch(l("auth/logout"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:d})}),o(null),c(null),u(null),f(!1),v(null),await N("logout","Logout utente")}finally{h(!1)}}async function y(){if(i){h(!0);try{let e=await fetch(l("auth/userinfo"),{method:"GET",headers:{Authorization:"Bearer ".concat(i)}}),t=await e.json();t.user?o(t.user):o(null)}catch(e){o(null)}finally{h(!1)}}}async function N(e,t){try{await fetch(l("auth/log"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:(null==s?void 0:s.id)||p,action:e,ip:void 0,timestamp:new Date().toISOString(),details:t})})}catch(e){}}return(0,a.useEffect)(()=>{let e=sessionStorage.getItem("accessToken"),t=sessionStorage.getItem("refreshToken");e&&t&&(c(e),u(t)),h(!1)},[]),(0,a.useEffect)(()=>{i?sessionStorage.setItem("accessToken",i):sessionStorage.removeItem("accessToken"),d?sessionStorage.setItem("refreshToken",d):sessionStorage.removeItem("refreshToken")},[i,d]),(0,a.useEffect)(()=>{i?y():o(null)},[i]),(0,r.jsx)(n.Provider,{value:{user:s,accessToken:i,refreshToken:d,isAuthenticated:!!s&&!!i,loading:x,mfaRequired:m,login:g,verifyMfa:j,logout:b,fetchUser:y},children:t})}},4796:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var r=s(5155),a=s(2115),l=s(3274),n=s(1130),o=s(2596),i=s(9688);function c(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,o.$)(t))}let d=a.forwardRef((e,t)=>{let{children:s,variant:a="primary",size:l="md",isLoading:n=!1,leftIcon:o,rightIcon:i,className:d,disabled:u,...x}=e,h=c("inline-flex items-center justify-center font-medium transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-neutral-800","disabled:opacity-50 disabled:cursor-not-allowed","rounded-lg",{"px-3 py-1.5 text-sm gap-1.5 h-8":"sm"===l,"px-4 py-2 text-sm gap-2 h-10":"md"===l,"px-6 py-3 text-base gap-2 h-12":"lg"===l},{"bg-[#3B82F6] hover:bg-[#3B82F6]/80 text-white focus:ring-[#3B82F6] shadow-sm":"primary"===a,"bg-neutral-700/60 hover:bg-neutral-600 text-neutral-200 border border-neutral-600/60 focus:ring-neutral-500":"secondary"===a,"bg-red-600 hover:bg-red-700 text-white focus:ring-red-500 shadow-sm":"danger"===a,"bg-green-600 hover:bg-green-700 text-white focus:ring-green-500 shadow-sm":"success"===a,"hover:bg-neutral-700/50 text-neutral-300 focus:ring-neutral-500":"ghost"===a,"border border-neutral-600/60 hover:bg-neutral-700/30 text-neutral-300 focus:ring-neutral-500":"outline"===a},d);return(0,r.jsxs)("button",{ref:t,className:h,disabled:u||n,...x,children:[n?(0,r.jsx)(()=>(0,r.jsxs)("svg",{className:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),{}):o,s,!n&&i]})});d.displayName="Button";var u=s(5339);let x=a.forwardRef(function(e,t){let{label:s,error:a,helper:l,leftIcon:n,rightIcon:o,required:i,className:d,id:x,...h}=e,m=x||"input-".concat(Math.random().toString(36).substr(2,9));return(0,r.jsxs)("div",{className:"space-y-2",children:[s&&(0,r.jsxs)("label",{htmlFor:m,className:"block text-sm font-medium text-neutral-300",children:[s," ",i&&(0,r.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,r.jsxs)("div",{className:"relative",children:[n&&(0,r.jsx)("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400 z-10",children:n}),(0,r.jsx)("input",{ref:t,id:m,className:c("w-full px-3 py-2 bg-neutral-700/60 border rounded-lg text-white placeholder-neutral-400","focus:outline-none focus:border-[#3B82F6] transition-colors","disabled:opacity-50 disabled:cursor-not-allowed",a?"border-red-500 focus:border-red-500":"border-neutral-600/60",n&&"pl-10",o&&"pr-10",d),...h}),o&&(0,r.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-neutral-400",children:o})]}),a&&(0,r.jsxs)("p",{className:"text-red-400 text-sm flex items-center gap-1",children:[(0,r.jsx)(u.A,{className:"w-4 h-4"}),a]}),l&&!a&&(0,r.jsx)("p",{className:"text-neutral-500 text-sm",children:l})]})});x.displayName="Input",a.forwardRef(function(e,t){let{label:s,error:a,helper:l,required:n,className:o,id:i,...d}=e,x=i||"textarea-".concat(Math.random().toString(36).substr(2,9));return(0,r.jsxs)("div",{className:"space-y-2",children:[s&&(0,r.jsxs)("label",{htmlFor:x,className:"block text-sm font-medium text-neutral-300",children:[s," ",n&&(0,r.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,r.jsx)("textarea",{ref:t,id:x,className:c("w-full px-3 py-2 bg-neutral-700/60 border rounded-lg text-white placeholder-neutral-400","focus:outline-none focus:border-[#3B82F6] transition-colors","disabled:opacity-50 disabled:cursor-not-allowed","resize-vertical min-h-[80px]",a?"border-red-500 focus:border-red-500":"border-neutral-600/60",o),...d}),a&&(0,r.jsxs)("p",{className:"text-red-400 text-sm flex items-center gap-1",children:[(0,r.jsx)(u.A,{className:"w-4 h-4"}),a]}),l&&!a&&(0,r.jsx)("p",{className:"text-neutral-500 text-sm",children:l})]})}).displayName="TextArea";var h=s(5695);function m(){var e;let{login:t,user:s,isAuthenticated:o,loading:i,mfaRequired:c,verifyMfa:u,logout:m}=(0,l.A)(),[f,p]=(0,a.useState)(""),[v,g]=(0,a.useState)(""),[j,b]=(0,a.useState)(""),[y,N]=(0,a.useState)(null),w=(0,h.useRouter)();async function S(e){e.preventDefault(),N(null);try{await t(f,v)}catch(e){N(e instanceof Error?e.message:"Errore sconosciuto")}}async function k(e){e.preventDefault(),N(null);try{await u((null==s?void 0:s.id)||"",j)}catch(e){N(e instanceof Error?e.message:"Errore sconosciuto")}}return(0,a.useEffect)(()=>{o&&w.replace("/")},[o,w]),(0,r.jsx)(n.A,{pageTitle:"Login",pageDescription:"Accedi al gestionale aziendale.",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto bg-neutral-800 border border-neutral-700 rounded-lg p-8 mt-8 shadow-lg",children:[i&&(0,r.jsx)("div",{className:"mb-4 text-info",children:"Caricamento..."}),!o&&!c&&(0,r.jsxs)("form",{onSubmit:S,className:"space-y-6 mb-4",children:[(0,r.jsx)(x,{label:"Email",value:f,onChange:e=>p(e.target.value),placeholder:"Inserisci la tua email",type:"email",autoComplete:"username",required:!0}),(0,r.jsx)(x,{label:"Password",value:v,onChange:e=>g(e.target.value),placeholder:"Password",type:"password",autoComplete:"current-password",required:!0}),(0,r.jsx)(d,{type:"submit",variant:"primary",className:"w-full",children:"Login"})]}),c&&(0,r.jsxs)("form",{onSubmit:k,className:"space-y-6 mb-4",children:[(0,r.jsx)(x,{label:"Codice MFA",value:j,onChange:e=>b(e.target.value),placeholder:"Inserisci il codice MFA",autoComplete:"one-time-code",required:!0}),(0,r.jsx)(d,{type:"submit",variant:"success",className:"w-full",children:"Verifica MFA"})]}),o&&(0,r.jsxs)("div",{className:"mb-4 p-4 bg-neutral-700 border border-green-600 rounded-lg",children:[(0,r.jsxs)("div",{className:"mb-2 font-semibold text-green-400",children:["Benvenuto, ",null==s?void 0:s.nome," ",null==s?void 0:s.cognome]}),(0,r.jsxs)("div",{className:"text-sm text-neutral-200",children:["Email: ",null==s?void 0:s.email]}),(0,r.jsxs)("div",{className:"text-sm text-neutral-200",children:["Ruoli: ",null==s||null==(e=s.roles)?void 0:e.join(", ")]}),(0,r.jsxs)("div",{className:"text-sm text-neutral-200",children:["MFA: ",(null==s?void 0:s.mfaEnabled)?"Attivo":"Non attivo"]}),(0,r.jsx)(d,{onClick:m,variant:"danger",className:"mt-4 w-full",children:"Logout"})]}),y&&(0,r.jsx)("div",{className:"text-error font-semibold mt-2",children:y})]})})}},6779:(e,t,s)=>{Promise.resolve().then(s.bind(s,4796))}},e=>{var t=t=>e(e.s=t);e.O(0,[261,671,441,684,358],()=>t(6779)),_N_E=e.O()}]);